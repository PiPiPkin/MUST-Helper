{"version":3,"sources":["uni-app:///main.js",null,"webpack:///C:/Users/小墨同学123/Documents/HBuilderProjects/澳科保姆前端/pages/canteen/shop-detail.vue?c514","webpack:///C:/Users/小墨同学123/Documents/HBuilderProjects/澳科保姆前端/pages/canteen/shop-detail.vue?982f","webpack:///C:/Users/小墨同学123/Documents/HBuilderProjects/澳科保姆前端/pages/canteen/shop-detail.vue?518e","uni-app:///pages/canteen/shop-detail.vue","webpack:///C:/Users/小墨同学123/Documents/HBuilderProjects/澳科保姆前端/pages/canteen/shop-detail.vue?68ab","webpack:///C:/Users/小墨同学123/Documents/HBuilderProjects/澳科保姆前端/pages/canteen/shop-detail.vue?082b"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","shopId","canteenId","showRating","newComment","isCommentExpanded","isLiking","isLoading","userRating","taste","price","hygiene","shop","name","image","rating","tasteRating","priceRating","hygieneRating","reviewCount","dishes","tags","averagePrice","monthlySales","comments","onLoad","console","uni","title","icon","setTimeout","methods","goBack","url","success","fail","showRatingPanel","hideRatingPanel","submitRating","totalScore","validItems","getShopDetail","shopsData","id","shopDetail","commentsData","userName","userAvatar","content","time","likeCount","isLiked","expandCommentInput","submitComment","toggleLike","comment","confirmDeleteComment"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,mBAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAwH;AACxH;AAC+D;AACL;AACa;;;AAGvE;AAC0M;AAC1M,gBAAgB,iNAAU;AAC1B,EAAE,iFAAM;AACR,EAAE,sFAAM;AACR,EAAE,+FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,0FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACrEA;AAAA;AAAA;AAAA;AAA2yB,CAAgB,yyBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eCutB/zB;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;QACAC;QACAC;QACAC;MACA;MACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACAC;IACA;EACA;EACAC;IAAA;IACAC;IAEA;MACA;MACA;MACA;IACA;MACAC;QACAC;QACAC;MACA;MACAC;QACA;MACA;IACA;EACA;EACAC;IACAC;MACAN;MACA;MACAA;MAEA;QACA;QACAA;QACAC;UACAM;UACAC;YACAR;UACA;UACAS;YACAT;YACA;YACAC;cACAM;YACA;UACA;QACA;MACA;QACA;QACAP;QACAC;UACAQ;YACAT;YACA;YACAC;cACAM;YACA;UACA;QACA;MACA;IACA;IACAG;MACA;IACA;IACAC;MACA;MACA;QACA5B;QACAC;QACAC;MACA;IACA;IACA2B;MACA;MACA;QACAX;UACAC;UACAC;QACA;QACA;MACA;;MAEA;MACA;MACA;MAEA;QACAU;QACAC;MACA;MAEA;QACAD;QACAC;MACA;MAEA;QACAD;QACAC;MACA;;MAEA;MACA;MAEAd;;MAEA;MACA;;MAEA;MACA;QACA;MACA;MAEA;QACA;MACA;MAEA;QACA;MACA;;MAEA;MACA;MACA;MAEAC;QACAC;QACAC;MACA;MAEA;IACA;IACAY;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEAf;gBACA;;gBAEA;gBACAgB;kBACA;oBACAC;oBACA9B;oBACAC;oBACAC;oBACAC;oBACAC;oBAAA;oBACAC;oBAAA;oBACAC;oBACAG;oBACAC;oBACAF;oBACAD,SACA;sBACAuB;sBACA9B;sBACAH;sBACAI;oBACA,GACA;sBACA6B;sBACA9B;sBACAH;sBACAI;oBACA,GACA;sBACA6B;sBACA9B;sBACAH;sBACAI;oBACA;kBAEA;kBACA;oBACA6B;oBACA9B;oBACAC;oBACAC;oBACAC;oBACAC;oBAAA;oBACAC;oBAAA;oBACAC;oBACAG;oBACAC;oBACAF;oBACAD,SACA;sBACAuB;sBACA9B;sBACAH;sBACAI;oBACA,GACA;sBACA6B;sBACA9B;sBACAH;sBACAI;oBACA,GACA;sBACA6B;sBACA9B;sBACAH;sBACAI;oBACA;kBAEA;gBACA,GACA;gBAAA;gBAAA,OACA;kBAAA;gBAAA;cAAA;gBAEA;gBACA8B;gBAAA,KACAA;kBAAA;kBAAA;gBAAA;gBACA;gBACA;;gBAEA;gBACAC;kBACA,MACA;oBACAF;oBACAG;oBACAC;oBACAhC;oBACAiC;oBACAC;oBACAC;oBACAC;kBACA,GACA;oBACAR;oBACAG;oBACAC;oBACAhC;oBACAiC;oBACAC;oBACAC;oBACAC;kBACA,EACA;kBACA,MACA;oBACAR;oBACAG;oBACAC;oBACAhC;oBACAiC;oBACAC;oBACAC;oBACAC;kBACA;gBAEA,GAEA;gBACA;gBACAzB;gBAAA;gBAAA;cAAA;gBAAA,MAEA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAGAA;gBACA;gBACAC;kBACAC;kBACAC;gBACA;gBACAC;kBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACAsB;MACA;IACA;IAEAC;MACA;QACA1B;UACAC;UACAC;QACA;QACA;MACA;MAEA;QACAc;QACAG;QACAC;QACAhC;QACAiC;QACAC;QACAC;QACAC;MACA;MAEA;MACA;MACA;MAEAxB;QACAC;QACAC;MACA;IACA;IAEAyB;MAAA;MACA;MACA;MAEA;MACA;QACAC;MACA;QACAA;MACA;MACAA;MAEAzB;QACA;MACA;IACA;IAEA0B;MAAA;MACA7B;QACAC;QACAoB;QACAd;UACA;YACA;YACAP;cACAC;cACAC;YACA;UACA;QACA;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;ACnkCA;AAAA;AAAA;AAAA;AAA4oC,CAAgB,smCAAG,EAAC,C;;;;;;;;;;;ACAhqC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/canteen/shop-detail.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/canteen/shop-detail.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./shop-detail.vue?vue&type=template&id=3bba56ba&\"\nvar renderjs\nimport script from \"./shop-detail.vue?vue&type=script&lang=js&\"\nexport * from \"./shop-detail.vue?vue&type=script&lang=js&\"\nimport style0 from \"./shop-detail.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/canteen/shop-detail.vue\"\nexport default component.exports","export * from \"-!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./shop-detail.vue?vue&type=template&id=3bba56ba&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.shop.rating ? _vm.shop.rating.toFixed(1) : null\n  var g1 = Math.round(_vm.shop.rating || 0)\n  var g2 = Math.round(_vm.shop.tasteRating || 0)\n  var g3 = _vm.shop.tasteRating ? _vm.shop.tasteRating.toFixed(1) : null\n  var g4 = Math.round(_vm.shop.priceRating || 0)\n  var g5 = _vm.shop.priceRating ? _vm.shop.priceRating.toFixed(1) : null\n  var g6 = Math.round(_vm.shop.hygieneRating || 0)\n  var g7 = _vm.shop.hygieneRating ? _vm.shop.hygieneRating.toFixed(1) : null\n  var g8 = _vm.comments.length\n  var g9 = _vm.comments.length\n  var l0 = _vm.__map(_vm.comments, function (item, index) {\n    var $orig = _vm.__get_orig(item)\n    var g10 = Math.round(item.rating)\n    var g11 = item.rating.toFixed(1)\n    return {\n      $orig: $orig,\n      g10: g10,\n      g11: g11,\n    }\n  })\n  if (!_vm._isMounted) {\n    _vm.e0 = function ($event, n) {\n      var _temp = arguments[arguments.length - 1].currentTarget.dataset,\n        _temp2 = _temp.eventParams || _temp[\"event-params\"],\n        n = _temp2.n\n      var _temp, _temp2\n      _vm.userRating.taste = n\n    }\n    _vm.e1 = function ($event, n) {\n      var _temp3 = arguments[arguments.length - 1].currentTarget.dataset,\n        _temp4 = _temp3.eventParams || _temp3[\"event-params\"],\n        n = _temp4.n\n      var _temp3, _temp4\n      _vm.userRating.price = n\n    }\n    _vm.e2 = function ($event, n) {\n      var _temp5 = arguments[arguments.length - 1].currentTarget.dataset,\n        _temp6 = _temp5.eventParams || _temp5[\"event-params\"],\n        n = _temp6.n\n      var _temp5, _temp6\n      _vm.userRating.hygiene = n\n    }\n  }\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        g1: g1,\n        g2: g2,\n        g3: g3,\n        g4: g4,\n        g5: g5,\n        g6: g6,\n        g7: g7,\n        g8: g8,\n        g9: g9,\n        l0: l0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./shop-detail.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./shop-detail.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"container\">\r\n\t\t<view class=\"loading-overlay\" v-if=\"isLoading\">\r\n\t\t\t<view class=\"loading-spinner\"></view>\r\n\t\t\t<text class=\"loading-text\">加载中...</text>\r\n\t\t</view>\r\n\t\t<!-- 顶部导航栏 -->\r\n\t\t<view class=\"header\">\r\n\t\t\t<view class=\"back-btn\" @click=\"goBack\">\r\n\t\t\t\t<text>←</text>\r\n\t\t\t</view>\r\n\t\t\t<text class=\"header-title\">{{shop.name || '店铺详情'}}</text>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 店铺信息 -->\r\n\t\t<view class=\"shop-info\">\r\n\t\t\t<view class=\"shop-header\">\r\n\t\t\t\t<text class=\"shop-name\">{{shop.name || '加载中...'}}</text>\r\n\t\t\t\t<view class=\"shop-tags\">\r\n\t\t\t\t\t<text class=\"tag\" v-for=\"(tag, index) in shop.tags\" :key=\"index\">{{tag}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<text class=\"shop-code\" v-if=\"shop.code\">{{shop.code}}</text>\r\n\t\t\t<text class=\"shop-code\" v-if=\"shop.code\">{{shop.code}}</text>\r\n\t\t\t<text class=\"shop-description\">{{shop.description || '暂无描述'}}</text>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 评分区 -->\r\n\t\t<view class=\"rating-section\">\r\n\t\t\t<view class=\"overall-rating\">\r\n\t\t\t\t<text class=\"rating-value\">{{shop.rating ? shop.rating.toFixed(1) : '0.0'}}</text>\r\n\t\t\t\t<view class=\"stars\">\r\n\t\t\t\t\t<text v-for=\"n in 5\" :key=\"n\" class=\"star\" \r\n\t\t\t\t\t\t  :class=\"{ 'filled': n <= Math.round(shop.rating || 0) }\">★</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<text class=\"review-count\">{{shop.reviewCount || 0}}人评价</text>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<view class=\"rating-details\">\r\n\t\t\t\t<view class=\"rating-item\">\r\n\t\t\t\t\t<text class=\"rating-label\">口味</text>\r\n\t\t\t\t\t<view class=\"rating-stars\">\r\n\t\t\t\t\t\t<text v-for=\"n in 5\" :key=\"n\" class=\"star\" \r\n\t\t\t\t\t\t\t  :class=\"{ 'filled': n <= Math.round(shop.tasteRating || 0) }\">★</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<text class=\"rating-score\">{{shop.tasteRating ? shop.tasteRating.toFixed(1) : '0.0'}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"rating-item\">\r\n\t\t\t\t\t<text class=\"rating-label\">价格</text>\r\n\t\t\t\t\t<view class=\"rating-stars\">\r\n\t\t\t\t\t\t<text v-for=\"n in 5\" :key=\"n\" class=\"star\" \r\n\t\t\t\t\t\t\t  :class=\"{ 'filled': n <= Math.round(shop.priceRating || 0) }\">★</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<text class=\"rating-score\">{{shop.priceRating ? shop.priceRating.toFixed(1) : '0.0'}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"rating-item\">\r\n\t\t\t\t\t<text class=\"rating-label\">卫生</text>\r\n\t\t\t\t\t<view class=\"rating-stars\">\r\n\t\t\t\t\t\t<text v-for=\"n in 5\" :key=\"n\" class=\"star\" \r\n\t\t\t\t\t\t\t  :class=\"{ 'filled': n <= Math.round(shop.hygieneRating || 0) }\">★</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<text class=\"rating-score\">{{shop.hygieneRating ? shop.hygieneRating.toFixed(1) : '0.0'}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<button class=\"rate-btn\" @click=\"showRatingPanel\">我要评分</button>\r\n\t\t</view>\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t<!-- 评论区 -->\r\n\t\t<view class=\"comment-section\">\r\n\t\t\t<view class=\"section-title\">\r\n\t\t\t\t<text>评论 ({{comments.length}})</text>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<view class=\"comment-list\">\r\n\t\t\t\t<view v-if=\"comments.length === 0\" class=\"no-comment\">\r\n\t\t\t\t\t<text>暂无评论，快来发表第一条评论吧</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"comment-item\" v-for=\"(item, index) in comments\" :key=\"index\">\r\n\t\t\t\t\t<view class=\"comment-header\">\r\n\t\t\t\t\t\t<image class=\"user-avatar\" :src=\"item.userAvatar || '/static/images/avatars/default.jpg'\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t\t<view class=\"comment-user-info\">\r\n\t\t\t\t\t\t\t<text class=\"user-name\">{{item.userName}}</text>\r\n\t\t\t\t\t\t\t<view class=\"comment-rating\">\r\n\t\t\t\t\t\t\t\t<text v-for=\"n in 5\" :key=\"n\" class=\"star\" \r\n\t\t\t\t\t\t\t\t\t  :class=\"{ 'filled': n <= Math.round(item.rating) }\">★</text>\r\n\t\t\t\t\t\t\t\t<text class=\"rating-text\">{{item.rating.toFixed(1)}}</text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<text class=\"comment-time\">{{item.time}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<text class=\"comment-content\">{{item.content}}</text>\r\n\t\t\t\t\t<view class=\"comment-footer\">\r\n\t\t\t\t\t\t<view class=\"like-btn\" @click=\"toggleLike(index)\" :class=\"{'liked': item.isLiked}\">\r\n\t\t\t\t\t\t\t<text class=\"like-icon\">👍</text>\r\n\t\t\t\t\t\t\t<text class=\"like-count\">{{item.likeCount}}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"delete-btn\" v-if=\"item.userName === '我'\" @click=\"confirmDeleteComment(index)\">\r\n\t\t\t\t\t\t\t<text class=\"delete-icon\">🗑️</text>\r\n\t\t\t\t\t\t\t<text>删除</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<view class=\"comment-input-box\" :class=\"{'expanded': isCommentExpanded}\">\r\n\t\t\t\t<view class=\"input-wrapper\" @click=\"expandCommentInput\">\r\n\t\t\t\t\t<textarea v-if=\"isCommentExpanded\" \r\n\t\t\t\t\t\t\t   class=\"comment-textarea\" \r\n\t\t\t\t\t\t\t   v-model=\"newComment\" \r\n\t\t\t\t\t\t\t   placeholder=\"分享你对这家店的评价、推荐菜品、用餐体验...\"\r\n\t\t\t\t\t\t\t   :focus=\"isCommentExpanded\"\r\n\t\t\t\t\t\t\t   auto-height></textarea>\r\n\t\t\t\t\t<input v-else \r\n\t\t\t\t\t\t\ttype=\"text\" \r\n\t\t\t\t\t\t\tplaceholder=\"分享你对这家店的评价、推荐菜品、用餐体验...\" \r\n\t\t\t\t\t\t\tv-model=\"newComment\" />\r\n\t\t\t\t</view>\r\n\t\t\t\t<button class=\"submit-btn\" @click=\"submitComment\">发表</button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 评分面板 -->\r\n\t\t<view class=\"rating-panel\" v-if=\"showRating\">\r\n\t\t\t<view class=\"rating-panel-content\">\r\n\t\t\t\t<view class=\"panel-header\">\r\n\t\t\t\t\t<text class=\"panel-title\">评分</text>\r\n\t\t\t\t\t<text class=\"close-btn\" @click=\"hideRatingPanel\">×</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t\r\n\t\t\t\t<view class=\"panel-body\">\r\n\t\t\t\t\t<view class=\"panel-rating-item\">\r\n\t\t\t\t\t\t<text class=\"panel-rating-label\">口味</text>\r\n\t\t\t\t\t\t<view class=\"panel-rating-stars\">\r\n\t\t\t\t\t\t\t<text v-for=\"n in 5\" :key=\"n\" class=\"panel-star\" \r\n\t\t\t\t\t\t\t\t  :class=\"{ 'filled': n <= userRating.taste }\"\r\n\t\t\t\t\t\t\t\t  @click=\"userRating.taste = n\">★</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"panel-rating-item\">\r\n\t\t\t\t\t\t<text class=\"panel-rating-label\">价格</text>\r\n\t\t\t\t\t\t<view class=\"panel-rating-stars\">\r\n\t\t\t\t\t\t\t<text v-for=\"n in 5\" :key=\"n\" class=\"panel-star\" \r\n\t\t\t\t\t\t\t\t  :class=\"{ 'filled': n <= userRating.price }\"\r\n\t\t\t\t\t\t\t\t  @click=\"userRating.price = n\">★</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"panel-rating-item\">\r\n\t\t\t\t\t\t<text class=\"panel-rating-label\">卫生</text>\r\n\t\t\t\t\t\t<view class=\"panel-rating-stars\">\r\n\t\t\t\t\t\t\t<text v-for=\"n in 5\" :key=\"n\" class=\"panel-star\" \r\n\t\t\t\t\t\t\t\t  :class=\"{ 'filled': n <= userRating.hygiene }\"\r\n\t\t\t\t\t\t\t\t  @click=\"userRating.hygiene = n\">★</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t\r\n\t\t\t\t<button class=\"submit-rating-btn\" @click=\"submitRating\">提交评分</button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<style>\r\n.container {\r\n\tmin-height: 100vh;\r\n\tbackground-color: #f5f5f5;\r\n\tposition: relative;\r\n}\r\n\r\n.loading-overlay {\r\n\tposition: fixed;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\tright: 0;\r\n\tbottom: 0;\r\n\tbackground-color: rgba(255, 255, 255, 0.9);\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tjustify-content: center;\r\n\talign-items: center;\r\n\tz-index: 9999;\r\n}\r\n\r\n.loading-spinner {\r\n\twidth: 60rpx;\r\n\theight: 60rpx;\r\n\tborder: 6rpx solid #f3f3f3;\r\n\tborder-top: 6rpx solid #3498db;\r\n\tborder-radius: 50%;\r\n\tanimation: spin 1s linear infinite;\r\n}\r\n\r\n.loading-text {\r\n\tmargin-top: 20rpx;\r\n\tcolor: #666666;\r\n\tfont-size: 28rpx;\r\n}\r\n\r\n@keyframes spin {\r\n\t0% { transform: rotate(0deg); }\r\n\t100% { transform: rotate(360deg); }\r\n}\r\n\r\n.header {\r\n\tbackground-color: #3498db;\r\n\tpadding: 20rpx;\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tposition: fixed;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\tright: 0;\r\n\tz-index: 100;\r\n}\r\n\r\n.back-btn {\r\n\tcolor: #ffffff;\r\n\tfont-size: 36rpx;\r\n\tpadding: 0 20rpx;\r\n}\r\n\r\n.header-title {\r\n\tflex: 1;\r\n\tcolor: #ffffff;\r\n\tfont-size: 36rpx;\r\n\tfont-weight: bold;\r\n\ttext-align: center;\r\n}\r\n\r\n.shop-info {\r\n\tmargin-bottom: 40rpx;\r\n}\r\n\r\n.shop-header {\r\n\tmargin-bottom: 20rpx;\r\n}\r\n\r\n.shop-name {\r\n\tfont-size: 36rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #333;\r\n\tmargin-bottom: 10rpx;\r\n\tdisplay: block;\r\n}\r\n\r\n.shop-tags {\r\n\tdisplay: flex;\r\n\tflex-wrap: wrap;\r\n\tgap: 10rpx;\r\n\tmargin-top: 10rpx;\r\n}\r\n\r\n.tag {\r\n\tpadding: 4rpx 12rpx;\r\n\tbackground-color: #eef7fd;\r\n\tborder-radius: 4rpx;\r\n\tfont-size: 24rpx;\r\n\tcolor: #3498db;\r\n}\r\n\r\n.shop-description {\r\n\tfont-size: 28rpx;\r\n\tcolor: #333;\r\n\tline-height: 1.6;\r\n}\r\n\r\n.rating-section {\r\n\tbackground-color: #f8f9fa;\r\n\tborder-radius: 16rpx;\r\n\tpadding: 30rpx;\r\n\tmargin-bottom: 40rpx;\r\n}\r\n\r\n.overall-rating {\r\n\ttext-align: center;\r\n\tmargin-bottom: 30rpx;\r\n}\r\n\r\n.rating-value {\r\n\tfont-size: 48rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #f39c12;\r\n}\r\n\r\n.stars {\r\n\tmargin: 10rpx 0;\r\n}\r\n\r\n.star {\r\n\tcolor: #ddd;\r\n\tfont-size: 36rpx;\r\n}\r\n\r\n.star.filled {\r\n\tcolor: #f39c12;\r\n}\r\n\r\n.review-count {\r\n\tfont-size: 24rpx;\r\n\tcolor: #666;\r\n}\r\n\r\n.rating-details {\r\n\tmargin-bottom: 30rpx;\r\n}\r\n\r\n.rating-item {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tmargin-bottom: 20rpx;\r\n}\r\n\r\n.rating-label {\r\n\twidth: 120rpx;\r\n\tfont-size: 28rpx;\r\n\tcolor: #333;\r\n}\r\n\r\n.rating-stars {\r\n\tflex: 1;\r\n\tdisplay: flex;\r\n\tmargin: 0 20rpx;\r\n}\r\n\r\n.rating-score {\r\n\tfont-size: 28rpx;\r\n\tcolor: #f39c12;\r\n}\r\n\r\n.rate-btn {\r\n\twidth: 100%;\r\n\theight: 80rpx;\r\n\tline-height: 80rpx;\r\n\ttext-align: center;\r\n\tbackground-color: #3498db;\r\n\tcolor: #fff;\r\n\tborder-radius: 40rpx;\r\n\tfont-size: 28rpx;\r\n}\r\n\r\n.rating-panel {\r\n\tposition: fixed;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\tright: 0;\r\n\tbottom: 0;\r\n\tbackground-color: rgba(0, 0, 0, 0.5);\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\tz-index: 1000;\r\n\tanimation: fadeIn 0.3s ease-in-out;\r\n}\r\n\r\n.rating-panel-content {\r\n\tbackground-color: #ffffff;\r\n\tborder-radius: 12rpx;\r\n\twidth: 80%;\r\n\tmax-width: 600rpx;\r\n\tpadding: 30rpx;\r\n}\r\n\r\n.panel-header {\r\n\tdisplay: flex;\r\n\tjustify-content: space-between;\r\n\talign-items: center;\r\n\tmargin-bottom: 30rpx;\r\n}\r\n\r\n.panel-title {\r\n\tfont-size: 32rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #333333;\r\n}\r\n\r\n.close-btn {\r\n\tfont-size: 40rpx;\r\n\tcolor: #999999;\r\n\tpadding: 10rpx;\r\n}\r\n\r\n.panel-body {\r\n\tpadding: 20rpx 0;\r\n}\r\n\r\n.panel-rating-item {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tmargin-bottom: 30rpx;\r\n\tpadding: 20rpx;\r\n\tbackground-color: #f8f9fa;\r\n\tborder-radius: 8rpx;\r\n\ttransition: all 0.3s ease;\r\n}\r\n\r\n.panel-rating-item:hover {\r\n\tbackground-color: #e9ecef;\r\n\ttransform: translateX(10rpx);\r\n}\r\n\r\n.panel-rating-label {\r\n\twidth: 120rpx;\r\n\tfont-size: 28rpx;\r\n\tcolor: #333333;\r\n}\r\n\r\n@keyframes fadeIn {\r\n    from {\r\n        opacity: 0;\r\n    }\r\n    to {\r\n        opacity: 1;\r\n    }\r\n}\r\n\r\n.panel-rating-stars {\r\n\tflex: 1;\r\n\tdisplay: flex;\r\n\tgap: 10rpx;\r\n\tjustify-content: center;\r\n}\r\n\r\n.panel-star {\r\n\tfont-size: 40rpx;\r\n\tcolor: #ddd;\r\n}\r\n\r\n.panel-star.filled {\r\n\tcolor: #f39c12;\r\n}\r\n\r\n.submit-rating-btn {\r\n\tbackground-color: #3498db;\r\n\tcolor: #ffffff;\r\n\tborder-radius: 8rpx;\r\n\tfont-size: 28rpx;\r\n\tpadding: 16rpx 0;\r\n\tmargin-top: 20rpx;\r\n}\r\n\r\n.dish-section {\r\n\tbackground-color: #ffffff;\r\n\tmargin-top: 20rpx;\r\n\tpadding: 20rpx;\r\n}\r\n\r\n.section-title {\r\n\tfont-size: 32rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #333333;\r\n\tmargin-bottom: 20rpx;\r\n}\r\n\r\n.dish-scroll {\r\n\twidth: 100%;\r\n}\r\n\r\n.dish-list {\r\n\tdisplay: flex;\r\n\tgap: 20rpx;\r\n\tpadding: 10rpx 0;\r\n}\r\n\r\n.dish-item {\r\n\tflex-shrink: 0;\r\n\twidth: 200rpx;\r\n}\r\n\r\n.dish-image {\r\n\twidth: 200rpx;\r\n\theight: 200rpx;\r\n\tborder-radius: 8rpx;\r\n}\r\n\r\n.dish-name {\r\n\tfont-size: 26rpx;\r\n\tcolor: #333333;\r\n\tmargin-top: 10rpx;\r\n}\r\n\r\n.dish-price {\r\n\tfont-size: 24rpx;\r\n\tcolor: #e74c3c;\r\n\tmargin-top: 6rpx;\r\n}\r\n\r\n/* 评论区样式 */\r\n.comment-section {\r\n\tmargin-top: 40rpx;\r\n}\r\n\r\n.section-title {\r\n\tfont-size: 32rpx;\r\n\tfont-weight: bold;\r\n\tmargin-bottom: 30rpx;\r\n}\r\n\r\n.comment-list {\r\n\tmargin-bottom: 30rpx;\r\n}\r\n\r\n.no-comment {\r\n\ttext-align: center;\r\n\tpadding: 40rpx 0;\r\n\tcolor: #999;\r\n\tfont-size: 28rpx;\r\n}\r\n\r\n.comment-item {\r\n\tmargin-bottom: 30rpx;\r\n\tpadding-bottom: 30rpx;\r\n\tborder-bottom: 1rpx solid #eee;\r\n}\r\n\r\n.comment-header {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tmargin-bottom: 16rpx;\r\n}\r\n\r\n.user-avatar {\r\n\twidth: 80rpx;\r\n\theight: 80rpx;\r\n\tborder-radius: 50%;\r\n\tmargin-right: 20rpx;\r\n}\r\n\r\n.comment-user-info {\r\n\tflex: 1;\r\n}\r\n\r\n.user-name {\r\n\tfont-size: 28rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #333;\r\n\tmargin-bottom: 6rpx;\r\n\tdisplay: block;\r\n}\r\n\r\n.comment-rating {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n}\r\n\r\n.comment-rating .star {\r\n\tfont-size: 24rpx;\r\n}\r\n\r\n.rating-text {\r\n\tfont-size: 24rpx;\r\n\tcolor: #f39c12;\r\n\tmargin-left: 10rpx;\r\n}\r\n\r\n.comment-time {\r\n\tfont-size: 24rpx;\r\n\tcolor: #999;\r\n}\r\n\r\n.comment-content {\r\n\tfont-size: 28rpx;\r\n\tcolor: #333;\r\n\tline-height: 1.6;\r\n\tmargin-bottom: 16rpx;\r\n\tdisplay: block;\r\n}\r\n\r\n.comment-footer {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n}\r\n\r\n.like-btn {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tfont-size: 24rpx;\r\n\tcolor: #666;\r\n\tmargin-right: 30rpx;\r\n}\r\n\r\n.like-icon {\r\n\tmargin-right: 6rpx;\r\n}\r\n\r\n.like-count {\r\n\tfont-size: 24rpx;\r\n}\r\n\r\n.like-btn.liked {\r\n\tcolor: #e74c3c;\r\n}\r\n\r\n.like-btn.liked .like-icon {\r\n\tcolor: #e74c3c;\r\n}\r\n\r\n.delete-btn {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tfont-size: 24rpx;\r\n\tcolor: #666;\r\n}\r\n\r\n.delete-icon {\r\n\tmargin-right: 6rpx;\r\n}\r\n\r\n.comment-input-box {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tbackground-color: #f8f9fa;\r\n\tborder-radius: 40rpx;\r\n\tpadding: 10rpx 20rpx;\r\n}\r\n\r\n.comment-input-box.expanded {\r\n\tbackground-color: #fff;\r\n\tborder: 1rpx solid #eee;\r\n\tborder-radius: 12rpx;\r\n\tpadding: 20rpx;\r\n}\r\n\r\n.input-wrapper {\r\n\tflex: 1;\r\n}\r\n\r\n.comment-textarea {\r\n\twidth: 100%;\r\n\tmin-height: 120rpx;\r\n\tfont-size: 28rpx;\r\n\tline-height: 1.5;\r\n}\r\n\r\n.submit-btn {\r\n\tbackground-color: #3498db;\r\n\tcolor: #ffffff;\r\n\tborder-radius: 40rpx;\r\n\tfont-size: 28rpx;\r\n\tpadding: 10rpx 30rpx;\r\n\tmargin-left: 20rpx;\r\n}\r\n.rating-panel {\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    background-color: rgba(0, 0, 0, 0.5);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    z-index: 1000;\r\n}\r\n\r\n.rating-panel-content {\r\n    background-color: #ffffff;\r\n    border-radius: 12rpx;\r\n    width: 80%;\r\n    max-width: 600rpx;\r\n    padding: 30rpx;\r\n}\r\n\r\n.panel-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    margin-bottom: 30rpx;\r\n}\r\n\r\n.panel-title {\r\n    font-size: 32rpx;\r\n    font-weight: bold;\r\n    color: #333333;\r\n}\r\n\r\n.close-btn {\r\n    font-size: 40rpx;\r\n    color: #999999;\r\n    padding: 10rpx;\r\n}\r\n\r\n.panel-body {\r\n    padding: 20rpx 0;\r\n}\r\n\r\n.panel-rating-item {\r\n    display: flex;\r\n    align-items: center;\r\n    margin-bottom: 30rpx;\r\n}\r\n\r\n.panel-rating-label {\r\n    width: 120rpx;\r\n    font-size: 28rpx;\r\n    color: #333333;\r\n}\r\n\r\n.panel-rating-stars {\r\n    flex: 1;\r\n    display: flex;\r\n    justify-content: center;\r\n    gap: 10rpx;\r\n}\r\n\r\n.panel-star {\r\n    font-size: 40rpx;\r\n    color: #ddd;\r\n}\r\n\r\n.panel-star.filled {\r\n    color: #f39c12;\r\n}\r\n\r\n.submit-rating-btn {\r\n    background-color: #3498db;\r\n    color: #ffffff;\r\n    border-radius: 40rpx;\r\n    font-size: 28rpx;\r\n    padding: 16rpx 0;\r\n    margin-top: 20rpx;\r\n}\r\n</style>\r\n\r\n<script>\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tshopId: null,\r\n\t\t\tcanteenId: null,\r\n\t\t\tshowRating: false,\r\n\t\t\tnewComment: '',\r\n\t\t\tisCommentExpanded: false,\r\n\t\t\tisLiking: false,\r\n\t\t\tisLoading: true,\r\n\t\t\tuserRating: {\r\n\t\t\t\ttaste: 0,\r\n\t\t\t\tprice: 0,\r\n\t\t\t\thygiene: 0\r\n\t\t\t},\r\n\t\t\tshop: {\r\n\t\t\t\tname: '加载中...',\r\n\t\t\t\timage: '',\r\n\t\t\t\trating: 0,\r\n\t\t\t\ttasteRating: 0,\r\n\t\t\t\tpriceRating: 0,\r\n\t\t\t\thygieneRating: 0,\r\n\t\t\t\treviewCount: 0,\r\n\t\t\t\tdishes: [],\r\n\t\t\t\ttags: [],\r\n\t\t\t\taveragePrice: 0,\r\n\t\t\t\tmonthlySales: 0\r\n\t\t\t},\r\n\t\t\tcomments: []\r\n\t\t}\r\n\t},\r\n\tonLoad(options) {\r\n\t\tconsole.log('店铺详情页面加载，参数:', options);\r\n\t\t\r\n\t\tif (options.shopId) {\r\n\t\t\tthis.shopId = parseInt(options.shopId);\r\n\t\t\tthis.canteenId = options.canteenId ? parseInt(options.canteenId) : null;\r\n\t\t\tthis.getShopDetail();\r\n\t\t} else {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '店铺ID不存在',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t});\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.goBack();\r\n\t\t\t}, 1500);\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tgoBack() {\r\n\t\t\tconsole.log('返回上一页');\r\n\t\t\tconst pages = getCurrentPages();\r\n\t\t\tconsole.log('当前页面栈:', pages.length);\r\n\t\t\t\r\n\t\t\tif (pages.length <= 1) {\r\n\t\t\t\t// 如果当前是第一个页面，直接跳转到食堂列表页\r\n\t\t\t\tconsole.log('尝试跳转到食堂列表页');\r\n\t\t\t\tuni.switchTab({\r\n\t\t\t\t\turl: '/pages/canteen/index',\r\n\t\t\t\t\tsuccess: function() {\r\n\t\t\t\t\t\tconsole.log('跳转成功');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: function(err) {\r\n\t\t\t\t\t\tconsole.error('跳转失败:', err);\r\n\t\t\t\t\t\t// 尝试使用 reLaunch 作为备选方案\r\n\t\t\t\t\t\tuni.reLaunch({\r\n\t\t\t\t\t\t\turl: '/pages/canteen/index'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t// 如果不是第一个页面，则正常返回\r\n\t\t\t\tconsole.log('尝试返回上一页');\r\n\t\t\t\tuni.navigateBack({\r\n\t\t\t\t\tfail: function(err) {\r\n\t\t\t\t\t\tconsole.error('返回失败:', err);\r\n\t\t\t\t\t\t// 如果返回失败，尝试跳转到食堂列表页\r\n\t\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\t\turl: '/pages/canteen/index'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tshowRatingPanel() {\r\n\t\t\tthis.showRating = true;\r\n\t\t},\r\n\t\thideRatingPanel() {\r\n\t\t\tthis.showRating = false;\r\n\t\t\tthis.userRating = {\r\n\t\t\t\ttaste: 0,\r\n\t\t\t\tprice: 0,\r\n\t\t\t\thygiene: 0\r\n\t\t\t};\r\n\t\t},\r\n\t\tsubmitRating() {\r\n\t\t\t// 确保至少有一项评分不为0\r\n\t\t\tif (this.userRating.taste === 0 && this.userRating.price === 0 && this.userRating.hygiene === 0) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '请至少评分一项',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// 计算平均分时，只计算非0项\r\n\t\t\tlet totalScore = 0;\r\n\t\t\tlet validItems = 0;\r\n\t\t\t\r\n\t\t\tif (this.userRating.taste > 0) {\r\n\t\t\t\ttotalScore += this.userRating.taste;\r\n\t\t\t\tvalidItems++;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this.userRating.price > 0) {\r\n\t\t\t\ttotalScore += this.userRating.price;\r\n\t\t\t\tvalidItems++;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this.userRating.hygiene > 0) {\r\n\t\t\t\ttotalScore += this.userRating.hygiene;\r\n\t\t\t\tvalidItems++;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// 计算平均分 - 即使所有项都是1星也能正常计算\r\n\t\t\tconst avgRating = validItems > 0 ? Number((totalScore / validItems).toFixed(1)) : 0;\r\n\t\t\t\r\n\t\t\tconsole.log('提交评分:', this.userRating, '平均分:', avgRating);\r\n\t\t\t\r\n\t\t\t// 使用精确计算更新评分\r\n\t\t\tconst newCount = this.shop.reviewCount + 1;\r\n\t\t\t\r\n\t\t\t// 更新各项评分 - 确保1星评分也能正常更新\r\n\t\t\tif (this.userRating.taste > 0) {\r\n\t\t\t\tthis.shop.tasteRating = Number(((this.shop.tasteRating * this.shop.reviewCount + this.userRating.taste) / newCount).toFixed(1));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this.userRating.price > 0) {\r\n\t\t\t\tthis.shop.priceRating = Number(((this.shop.priceRating * this.shop.reviewCount + this.userRating.price) / newCount).toFixed(1));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this.userRating.hygiene > 0) {\r\n\t\t\t\tthis.shop.hygieneRating = Number(((this.shop.hygieneRating * this.shop.reviewCount + this.userRating.hygiene) / newCount).toFixed(1));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// 更新总评分\r\n\t\t\tthis.shop.rating = Number(((this.shop.rating * this.shop.reviewCount + avgRating) / newCount).toFixed(1));\r\n\t\t\tthis.shop.reviewCount = newCount;\r\n\t\t\t\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '评分成功',\r\n\t\t\t\ticon: 'success'\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tthis.hideRatingPanel();\r\n\t\t},\r\n\t\tasync getShopDetail() {\r\n\t\t\ttry {\r\n\t\t\t\tconsole.log('获取店铺ID:', this.shopId);\r\n\t\t\t\tthis.isLoading = true;\r\n\t\t\t\t\r\n\t\t\t\t// 模拟店铺数据\r\n\t\t\t\tconst shopsData = {\r\n\t\t\t\t101: {\r\n\t\t\t\t\tid: 101,\r\n\t\t\t\t\tname: '南洋八打',\r\n\t\t\t\t\timage: '/static/shops/nanyang.jpg',\r\n\t\t\t\t\trating: 4.6,\r\n\t\t\t\t\ttasteRating: 4.7,\r\n\t\t\t\t\tpriceRating: 4.3,  // 修改：environmentRating -> priceRating\r\n\t\t\t\t\thygieneRating: 4.5, // 修改：serviceRating -> hygieneRating\r\n\t\t\t\t\treviewCount: 86,\r\n\t\t\t\t\taveragePrice: 28,\r\n\t\t\t\t\tmonthlySales: 1200,\r\n\t\t\t\t\ttags: ['东南亚', '咖喱', '海南鸡饭'],\r\n\t\t\t\t\tdishes: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid: 1,\r\n\t\t\t\t\t\t\tname: '海南鸡饭',\r\n\t\t\t\t\t\t\tprice: 25,\r\n\t\t\t\t\t\t\timage: '/static/dishes/hainanchicken.jpg'\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid: 2,\r\n\t\t\t\t\t\t\tname: '咖喱鸡',\r\n\t\t\t\t\t\t\tprice: 28,\r\n\t\t\t\t\t\t\timage: '/static/dishes/currychicken.jpg'\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid: 3,\r\n\t\t\t\t\t\t\tname: '椰浆饭',\r\n\t\t\t\t\t\t\tprice: 22,\r\n\t\t\t\t\t\t\timage: '/static/dishes/coconutrice.jpg'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t},\r\n\t\t\t\t102: {\r\n\t\t\t\t\tid: 102,\r\n\t\t\t\t\tname: '隆江猪脚饭',\r\n\t\t\t\t\timage: '/static/shops/longjiang.jpg',\r\n\t\t\t\t\trating: 4.7,\r\n\t\t\t\t\ttasteRating: 4.8,\r\n\t\t\t\t\tpriceRating: 4.5,  // 修改：environmentRating -> priceRating\r\n\t\t\t\t\thygieneRating: 4.6, // 修改：serviceRating -> hygieneRating\r\n\t\t\t\t\treviewCount: 124,\r\n\t\t\t\t\taveragePrice: 32,\r\n\t\t\t\t\tmonthlySales: 1500,\r\n\t\t\t\t\ttags: ['粤式', '猪脚', '烧腊'],\r\n\t\t\t\t\tdishes: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid: 1,\r\n\t\t\t\t\t\t\tname: '招牌猪脚饭',\r\n\t\t\t\t\t\t\tprice: 32,\r\n\t\t\t\t\t\t\timage: '/static/dishes/pigfoot.jpg'\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid: 2,\r\n\t\t\t\t\t\t\tname: '叉烧饭',\r\n\t\t\t\t\t\t\tprice: 30,\r\n\t\t\t\t\t\t\timage: '/static/dishes/charsiu.jpg'\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid: 3,\r\n\t\t\t\t\t\t\tname: '烧鸭饭',\r\n\t\t\t\t\t\t\tprice: 30,\r\n\t\t\t\t\t\t\timage: '/static/dishes/roastduck.jpg'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t};\r\n            // 模拟网络延迟\r\n            await new Promise(resolve => setTimeout(resolve, 500));\r\n            \r\n            // 获取店铺详情数据\r\n            const shopDetail = shopsData[this.shopId];\r\n            if (shopDetail) {\r\n                this.shop = {...shopDetail};\r\n                this.isLoading = false;\r\n                \r\n                // 模拟评论数据\r\n                const commentsData = {\r\n                    101: [\r\n                        {\r\n                            id: 1,\r\n                            userName: '美食达人',\r\n                            userAvatar: '/static/images/avatars/user1.jpg',\r\n                            rating: 4.5,\r\n                            content: '海南鸡饭非常正宗，鸡肉嫩滑多汁，配上特制的酱料简直绝配！店内环境也很干净，服务态度好。',\r\n                            time: '2023-05-15',\r\n                            likeCount: 12,\r\n                            isLiked: false\r\n                        },\r\n                        {\r\n                            id: 2,\r\n                            userName: '小吃货',\r\n                            userAvatar: '/static/images/avatars/user2.jpg',\r\n                            rating: 5.0,\r\n                            content: '咖喱鸡超级好吃，香料味道浓郁但不辣，很适合不能吃辣的人。价格也很实惠，一个人吃刚刚好。',\r\n                            time: '2023-05-10',\r\n                            likeCount: 8,\r\n                            isLiked: false\r\n                        }\r\n                    ],\r\n                    102: [\r\n                        {\r\n                            id: 1,\r\n                            userName: '肉食主义',\r\n                            userAvatar: '/static/images/avatars/user3.jpg',\r\n                            rating: 4.8,\r\n                            content: '猪脚饭真的太香了！猪脚软烂入味，配上卤汁拌饭简直绝了。每次来都必点，强烈推荐！',\r\n                            time: '2023-05-18',\r\n                            likeCount: 15,\r\n                            isLiked: false\r\n                        }\r\n                    ]\r\n                };\r\n            \r\n            // 设置评论数据\r\n            this.comments = commentsData[this.shopId] || [];\r\n            console.log('评论数据加载完成:', this.comments);\r\n            } else {\r\n                throw new Error('店铺不存在');\r\n            }\r\n        } catch (error) {\r\n            console.error('获取店铺详情失败:', error);\r\n            this.isLoading = false;\r\n            uni.showToast({\r\n                title: error.message || '获取店铺信息失败',\r\n                icon: 'none'\r\n            });\r\n            setTimeout(() => {\r\n                this.goBack();\r\n            }, 1500);\r\n        }\r\n        },\r\n        \r\n        // 添加其他必要的方法\r\n        expandCommentInput() {\r\n            this.isCommentExpanded = true;\r\n        },\r\n        \r\n        submitComment() {\r\n            if (!this.newComment.trim()) {\r\n                uni.showToast({\r\n                    title: '评论内容不能为空',\r\n                    icon: 'none'\r\n                });\r\n                return;\r\n            }\r\n            \r\n            const newComment = {\r\n                id: Date.now(),\r\n                userName: '我',\r\n                userAvatar: '/static/images/avatars/default.jpg',\r\n                rating: 5.0,\r\n                content: this.newComment,\r\n                time: new Date().toISOString().split('T')[0],\r\n                likeCount: 0,\r\n                isLiked: false\r\n            };\r\n            \r\n            this.comments.unshift(newComment);\r\n            this.newComment = '';\r\n            this.isCommentExpanded = false;\r\n            \r\n            uni.showToast({\r\n                title: '评论成功',\r\n                icon: 'success'\r\n            });\r\n        },\r\n        \r\n        toggleLike(index) {\r\n            if (this.isLiking) return;\r\n            this.isLiking = true;\r\n            \r\n            const comment = this.comments[index];\r\n            if (comment.isLiked) {\r\n                comment.likeCount--;\r\n            } else {\r\n                comment.likeCount++;\r\n            }\r\n            comment.isLiked = !comment.isLiked;\r\n            \r\n            setTimeout(() => {\r\n                this.isLiking = false;\r\n            }, 300);\r\n        },\r\n        \r\n        confirmDeleteComment(index) {\r\n            uni.showModal({\r\n                title: '确认删除',\r\n                content: '确定要删除这条评论吗？',\r\n                success: (res) => {\r\n                    if (res.confirm) {\r\n                        this.comments.splice(index, 1);\r\n                        uni.showToast({\r\n                            title: '删除成功',\r\n                            icon: 'success'\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n</script>\r\n","import mod from \"-!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./shop-detail.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./shop-detail.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1742818797771\n      var cssReload = require(\"C:/Users/小墨同学123/Downloads/HBuilderX.4.55.2025030718/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}