<view class="container"><view class="header"><view data-event-opts="{{[['tap',[['goBack',['$event']]]]]}}" class="back-btn" bindtap="__e"><text>←</text></view><text class="header-title">{{shop.name||'店铺详情'}}</text></view><view class="shop-info"><image class="shop-banner" src="{{shop.image}}" mode="aspectFill"></image><view class="shop-header"><text class="shop-name">{{shop.name||'加载中...'}}</text><view class="shop-meta"><view class="rating"><text class="rating-value">{{shop.rating?$root.g0:'0.0'}}</text><view class="stars"><block wx:for="{{5}}" wx:for-item="n" wx:for-index="__i0__" wx:key="*this"><text class="{{['star',(n<=$root.g1)?'filled':'']}}">★</text></block></view></view><text class="review-count">{{(shop.reviewCount||0)+"人评价"}}</text></view><view class="shop-tags"><block wx:for="{{shop.tags}}" wx:for-item="tag" wx:for-index="index" wx:key="index"><text class="tag">{{tag}}</text></block></view><view class="shop-details"><text class="price">{{"人均 ¥"+shop.averagePrice}}</text><text class="monthly-sales">{{"月售"+shop.monthlySales+"单"}}</text></view></view></view><view class="rating-section"><view class="overall-rating"><text class="rating-value">{{shop.rating?$root.g2:'0.0'}}</text><view class="stars"><block wx:for="{{5}}" wx:for-item="n" wx:for-index="__i1__" wx:key="*this"><text class="{{['star',(n<=$root.g3)?'filled':'']}}">★</text></block></view><text class="review-count">{{(shop.reviewCount||0)+"人评价"}}</text></view><view class="rating-details"><view class="rating-item"><text class="rating-label">口味 🍽️</text><view class="rating-stars"><block wx:for="{{5}}" wx:for-item="n" wx:for-index="__i2__" wx:key="*this"><text class="{{['star',(n<=$root.g4)?'filled':'']}}">★</text></block></view><text class="rating-score">{{shop.tasteRating?$root.g5:'0.0'}}</text></view><view class="rating-item"><text class="rating-label">价格 💰</text><view class="rating-stars"><block wx:for="{{5}}" wx:for-item="n" wx:for-index="__i3__" wx:key="*this"><text class="{{['star',(n<=$root.g6)?'filled':'']}}">★</text></block></view><text class="rating-score">{{shop.priceRating?$root.g7:'0.0'}}</text></view><view class="rating-item"><text class="rating-label">卫生 🧹</text><view class="rating-stars"><block wx:for="{{5}}" wx:for-item="n" wx:for-index="__i4__" wx:key="*this"><text class="{{['star',(n<=$root.g8)?'filled':'']}}">★</text></block></view><text class="rating-score">{{shop.hygieneRating?$root.g9:'0.0'}}</text></view></view><button data-event-opts="{{[['tap',[['showRatingPanel',['$event']]]]]}}" class="rate-btn" bindtap="__e">我要评分</button></view><block wx:if="{{$root.g10}}"><view class="dish-section"><view class="section-title"><text>招牌菜品</text></view><scroll-view class="dish-scroll" scroll-x="{{true}}"><view class="dish-list"><block wx:for="{{shop.dishes}}" wx:for-item="dish" wx:for-index="index" wx:key="index"><view class="dish-item"><image class="dish-image" src="{{dish.image}}" mode="aspectFill"></image><text class="dish-name">{{dish.name}}</text><text class="dish-price">{{"¥"+dish.price}}</text></view></block></view></scroll-view></view></block><view class="comment-section"><view class="section-title"><text>{{"评论 ("+$root.g11+")"}}</text></view><view class="comment-list"><block wx:if="{{$root.g12===0}}"><view class="no-comment"><text>暂无评论，快来发表第一条评论吧</text></view></block><block wx:for="{{$root.l0}}" wx:for-item="item" wx:for-index="index" wx:key="index"><view class="comment-item"><view class="comment-header"><image class="user-avatar" src="{{item.$orig.userAvatar||'/static/images/avatars/default.jpg'}}" mode="aspectFill"></image><view class="comment-user-info"><text class="user-name">{{item.$orig.userName}}</text><view class="comment-rating"><block wx:for="{{5}}" wx:for-item="n" wx:for-index="__i5__" wx:key="*this"><text class="{{['star',(n<=item.g13)?'filled':'']}}">★</text></block><text class="rating-text">{{item.g14}}</text></view></view><text class="comment-time">{{item.$orig.time}}</text></view><text class="comment-content">{{item.$orig.content}}</text><block wx:if="{{item.g15}}"><view class="comment-images"><block wx:for="{{item.$orig.images}}" wx:for-item="img" wx:for-index="imgIndex" wx:key="imgIndex"><image class="comment-image" src="{{img}}" mode="aspectFill" data-event-opts="{{[['tap',[['previewImage',['$0',imgIndex],[[['comments','',index,'images']]]]]]]}}" bindtap="__e"></image></block></view></block><view class="comment-footer"><view data-event-opts="{{[['tap',[['toggleLike',[index]]]]]}}" class="{{['like-btn',(item.$orig.isLiked)?'liked':'']}}" bindtap="__e"><text class="like-icon">👍</text><text class="like-count">{{item.$orig.likeCount}}</text></view><block wx:if="{{item.$orig.userName==='我'}}"><view data-event-opts="{{[['tap',[['confirmDeleteComment',[index]]]]]}}" class="delete-btn" bindtap="__e"><text class="delete-icon">🗑️</text><text>删除</text></view></block></view></view></block></view><view class="{{['comment-input-box',(isCommentExpanded)?'expanded':'']}}"><view data-event-opts="{{[['tap',[['expandCommentInput',['$event']]]]]}}" class="input-wrapper" bindtap="__e"><block wx:if="{{isCommentExpanded}}"><textarea class="comment-textarea" placeholder="分享你对这家店的评价、推荐菜品、用餐体验..." focus="{{isCommentExpanded}}" auto-height="{{true}}" data-event-opts="{{[['input',[['__set_model',['','newComment','$event',[]]]]]]}}" value="{{newComment}}" bindinput="__e"></textarea></block><block wx:else><input type="text" placeholder="分享你对这家店的评价、推荐菜品、用餐体验..." data-event-opts="{{[['input',[['__set_model',['','newComment','$event',[]]]]]]}}" value="{{newComment}}" bindinput="__e"/></block></view><button data-event-opts="{{[['tap',[['submitComment',['$event']]]]]}}" class="submit-btn" bindtap="__e">发表</button></view></view><block wx:if="{{showRating}}"><view class="rating-panel"><view class="rating-panel-content"><view class="panel-header"><text class="panel-title">评分</text><text data-event-opts="{{[['tap',[['hideRatingPanel',['$event']]]]]}}" class="close-btn" bindtap="__e">×</text></view><view class="panel-body"><view class="panel-rating-item"><text class="panel-rating-label">口味 🍽️</text><view class="panel-rating-stars"><block wx:for="{{5}}" wx:for-item="n" wx:for-index="__i6__" wx:key="*this"><text data-event-opts="{{[['tap',[['e0',['$event']]]]]}}" data-event-params="{{({n})}}" class="{{['panel-star',(n<=userRating.taste)?'filled':'']}}" bindtap="__e">★</text></block></view></view><view class="panel-rating-item"><text class="panel-rating-label">价格 💰</text><view class="panel-rating-stars"><block wx:for="{{5}}" wx:for-item="n" wx:for-index="__i7__" wx:key="*this"><text data-event-opts="{{[['tap',[['e1',['$event']]]]]}}" data-event-params="{{({n})}}" class="{{['panel-star',(n<=userRating.price)?'filled':'']}}" bindtap="__e">★</text></block></view></view><view class="panel-rating-item"><text class="panel-rating-label">卫生 🧹</text><view class="panel-rating-stars"><block wx:for="{{5}}" wx:for-item="n" wx:for-index="__i8__" wx:key="*this"><text data-event-opts="{{[['tap',[['e2',['$event']]]]]}}" data-event-params="{{({n})}}" class="{{['panel-star',(n<=userRating.hygiene)?'filled':'']}}" bindtap="__e">★</text></block></view></view></view><button data-event-opts="{{[['tap',[['submitRating',['$event']]]]]}}" class="submit-rating-btn" bindtap="__e">提交评分</button></view></view></block></view>